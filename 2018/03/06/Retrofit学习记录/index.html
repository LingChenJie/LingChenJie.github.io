<!DOCTYPE html>
<html lang="">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="记录Retrofit的学习过程"/>




  <meta name="keywords" content="android,框架,Retrofit," />





  <link rel="alternate" href="/default" title="Hexo">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1" />



<link rel="canonical" href="http://yoursite.com/2018/03/06/Retrofit学习记录/"/>


<meta name="description" content="记录Retrofit的学习过程">
<meta name="keywords" content="android,框架,Retrofit">
<meta property="og:type" content="article">
<meta property="og:title" content="Retrofit学习记录">
<meta property="og:url" content="http://yoursite.com/2018/03/06/Retrofit学习记录/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="记录Retrofit的学习过程">
<meta property="og:updated_time" content="2018-03-08T16:53:03.064Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Retrofit学习记录">
<meta name="twitter:description" content="记录Retrofit的学习过程">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1" />
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  



    <title> Retrofit学习记录 - Hexo </title>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">Hexo</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Retrofit学习记录
        
      </h1>

      <time class="post-time">
          Mar 06 2018
      </time>
    </header>



    
            <div class="post-content">
            <p>Retrofit 是一个 RESTful 的 Http 网络请求框架的封装，它的底层使用的 OkHttp</p>
<blockquote>
<p>什么是<code>RESTful</code>？<br>通俗的讲就是：看<code>Url</code>就知道要什么，看<code>http method</code>就知道干什么，看<code>http status code</code>就知道结果如何</p>
</blockquote>
<h4 id="1-添加Retrofit库的依赖"><a href="#1-添加Retrofit库的依赖" class="headerlink" title="1.添加Retrofit库的依赖"></a>1.添加Retrofit库的依赖</h4><blockquote>
<p>在app的build.gradle中添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">	...</span><br><span class="line">    // Retrofit库</span><br><span class="line">	compile &apos;com.squareup.retrofit2:retrofit:2.3.0&apos;</span><br><span class="line">	// okhttp库</span><br><span class="line">	compile &apos;com.squareup.okhttp3:okhttp:3.10.0&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="2-Retrofit实例"><a href="#2-Retrofit实例" class="headerlink" title="2.Retrofit实例"></a>2.Retrofit实例</h4><blockquote>
<p>通过一个小实例，我们就可以清楚<code>Retrofit</code>是如何使用的，下面看代码</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">// 1.创建Retrofit对象</span><br><span class="line">Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">        .baseUrl(BASE_URL)</span><br><span class="line">        .build();</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">// 2.定义接口，在接口中定义要请求的方法，比如说根据id获取图书信息</span><br><span class="line">public interface AppService &#123;</span><br><span class="line">    @GET(&quot;book/&#123;id&#125;&quot;)</span><br><span class="line">    Call&lt;ResponseBody&gt; getBook(@Path(&quot;id&quot;) int id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 3.进行调用</span><br><span class="line">AppService service = retrofit.create(AppService.class);</span><br><span class="line">Call&lt;ResponseBody&gt; call = service.getBook(1);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 4.结果回调</span><br><span class="line">call.enqueue(new Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onResponse(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response) &#123;</span><br><span class="line">		// 回调在主线程</span><br><span class="line">        Log.d(TAG, response.body().string());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onFailure(Call&lt;ResponseBody&gt; call, Throwable t) &#123;</span><br><span class="line">        t.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这样看来，是不是挺简单的，确实是挺简单的，<code>Retrofit</code>帮助我们做了那么多事，用起来还是挺不错的。<br>注意：<code>Retrofit</code> 的<code>bauseUrl</code>必须要以<code>/</code>结束</p>
</blockquote>
<h4 id="3-Retrofit注解"><a href="#3-Retrofit注解" class="headerlink" title="3.Retrofit注解"></a>3.Retrofit注解</h4><blockquote>
<p>1.请求方式的注解<br>@GET、@POST、@PUT、@DELETE、@PATCH、@HEAD、@OPTION、@HTTP<br>其中@HTTP可以替换其他的方法注解，它拥有三个属性：method、path、hasBody<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public interface AppService &#123;</span><br><span class="line">    /**</span><br><span class="line">     * method 表示请求的方法，区分大小写</span><br><span class="line">     * path表示路径</span><br><span class="line">     * hasBody表示是否有请求体</span><br><span class="line">     */</span><br><span class="line">    @HTTP(method = &quot;GET&quot;, path = &quot;blog/&#123;id&#125;&quot;, hasBody = false)</span><br><span class="line">    Call&lt;ResponseBody&gt; getBook(@Path(&quot;id&quot;) int id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>2.请求头注解<br>@Headers:用于添加固定请求头，可以同时添加多个。<br>@Header:作为方法的参数传入，用于添加不固定值的Header<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 固定请求头</span><br><span class="line">@Headers(&quot;Authorization: authorization&quot;)</span><br><span class="line">@GET(&quot;user&quot;)</span><br><span class="line">Call&lt;User&gt; getUser()</span><br><span class="line"></span><br><span class="line">// 不固定值的Header</span><br><span class="line">@GET(&quot;user&quot;)</span><br><span class="line">Call&lt;User&gt; getUser(@Header(&quot;Authorization&quot;) String authorization)</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>3.参数注解<br>@Body：用于非表单请求体<br>@Field、@FieldMap：用于Post请求提交请求的表单字段，与 @FormUrlEncoded 注解配合使用<br>@Part、@PartMap：用于Post请求文件上传，与@Multipart注解配合使用<br>@Query、@QueryMap：@GET方法的查询参数（Query = Url 中 ‘?’ 后面的 key-value）<br>@Path：替换URL地址的{占位符}<br>@Url：请求的url地址<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// &#123;user&#125; 会被替换为方法的第一个参数 user（被@Path注解作用）</span><br><span class="line">@GET(&quot;users/&#123;user&#125;/repos&quot;)</span><br><span class="line">Call&lt;ResponseBody&gt; getBook(@Path(&quot;user&quot;)String user);</span><br><span class="line"></span><br><span class="line">// 传入的url会替换@GET里面的请求地址</span><br><span class="line">@GET</span><br><span class="line">Call&lt;ResponseBody&gt; query(@Url String url);</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>注意：<br>如果使用@Path(“url”)出现url被转义的话，使用@Path(value = “url”, encoded = true)，禁止转义</p>
</blockquote>
<blockquote>
<p>4.请求和响应格式的注解<br>@FormUrlEncoded：请求体是一个Form表单的样式(Content-Type:application/x-www-form-urlencoded)<br>@Multipart：请求体是一个包含文件上传的Form表单样式<br>@Streaming：响应体的数据以流的行驶返回，如果数据比较大，尽量使用这个注解</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">// 比如：注册需要用户名和年龄</span><br><span class="line">@POST(&quot;regist&quot;)</span><br><span class="line">@FormUrlEncoded</span><br><span class="line">Call&lt;ResponseBody&gt; regist(@Field(&quot;username&quot;) String name, @Field(&quot;age&quot;) int age);</span><br><span class="line"></span><br><span class="line">// 或者也可以这样写，注意map中key的书写</span><br><span class="line">@POST(&quot;regist&quot;)</span><br><span class="line">@FormUrlEncoded</span><br><span class="line">Call&lt;ResponseBody&gt; regist(@FieldMap Map&lt;String, Object&gt; map);</span><br><span class="line"></span><br><span class="line">// 上传文件，注意除Part外，其它类型需加上表单字段</span><br><span class="line">@POST(&quot;upload&quot;)</span><br><span class="line">@Multipart</span><br><span class="line">Call&lt;ResponseBody&gt; upload(@Part(&quot;name&quot;) RequestBody name, @Part MultipartBody.Part file);</span><br><span class="line"></span><br><span class="line">// 或者也可以这样写，注意map中key的书写</span><br><span class="line">@POST(&quot;upload&quot;)</span><br><span class="line">@Multipart</span><br><span class="line">Call&lt;ResponseBody&gt; upload(@PartMap Map&lt;String, RequestBody&gt; map);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 调用上传</span><br><span class="line">RequestBody file = RequestBody.create(MediaType.parse(&quot;application/octet-stream&quot;), &quot;这里是模拟文件的内容&quot;);</span><br><span class="line">MultipartBody.Part filePart = MultipartBody.Part.createFormData(&quot;file&quot;, &quot;test.txt&quot;, file);</span><br><span class="line">service.upload(name, age, filePart);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 调用上传</span><br><span class="line">Map&lt;String, RequestBody&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">map.put(&quot;name&quot;,name);</span><br><span class="line">map.put(&quot;file\&quot;; filename=\&quot;test.txt&quot;,file);</span><br><span class="line">service.upload(map);</span><br></pre></td></tr></table></figure>
<h4 id="4-网络拦截器"><a href="#4-网络拦截器" class="headerlink" title="4.网络拦截器"></a>4.网络拦截器</h4><blockquote>
<p>addNetworkInterceptor添加的是网络拦截器，它会在request和response时分别被调用一次<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">// 添加依赖</span><br><span class="line">compile &apos;com.squareup.okhttp3:logging-interceptor:3.5.0&apos;</span><br><span class="line"></span><br><span class="line">// 创建日志拦截器</span><br><span class="line">public static HttpLoggingInterceptor getHttpLoggingInterceptor() &#123;</span><br><span class="line">	HttpLoggingInterceptor loggingInterceptor = new HttpLoggingInterceptor(</span><br><span class="line">			new HttpLoggingInterceptor.Logger() &#123;</span><br><span class="line">				@Override</span><br><span class="line">				public void log(String message) &#123;</span><br><span class="line">					Log.e(&quot;OkHttp&quot;, &quot;log = &quot; + message);</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">			&#125;);</span><br><span class="line">	loggingInterceptor.setLevel(HttpLoggingInterceptor.Level.BODY);</span><br><span class="line">	return loggingInterceptor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 统一请求拦截器，封装共有的请求数据，每次请求都会带上</span><br><span class="line">private Interceptor commonParamsInterceptor() &#123;</span><br><span class="line">	Interceptor commonParams = new Interceptor() &#123;</span><br><span class="line">		@Override</span><br><span class="line">		public okhttp3.Response intercept(Chain chain) throws IOException &#123;</span><br><span class="line">			Request originRequest = chain.request();</span><br><span class="line">			Request request;</span><br><span class="line">			HttpUrl httpUrl = originRequest.url().newBuilder().</span><br><span class="line">					addQueryParameter(&quot;paltform&quot;, &quot;android&quot;).</span><br><span class="line">					addQueryParameter(&quot;version&quot;, &quot;1.0.0&quot;).build();</span><br><span class="line">			request = originRequest.newBuilder().url(httpUrl).build();</span><br><span class="line">			return chain.proceed(request);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	return commonParams;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="5-数据解析器（Converter）"><a href="#5-数据解析器（Converter）" class="headerlink" title="5.数据解析器（Converter）"></a>5.数据解析器（Converter）</h4><blockquote>
<p>默认情况下，调用请求返回的结果都是Call<responsebody>，Converter可以为我们将ResponseBody转换为我们想要的类型。我们经常使用的GsonConverterFactory可以很方便的把服务端返回的json数据转为我们需要的对象，被@Body注解的的对象将会被Gson转换成RequestBody发送到服务器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 引入依赖</span><br><span class="line">compile &apos;com.squareup.retrofit2:converter-gson:2.0.2&apos;</span><br><span class="line"></span><br><span class="line">Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">		.baseUrl(BASE_URL) // 设置网络请求的Url地址</span><br><span class="line">		.addConverterFactory(GsonConverterFactory.create()) // 设置数据解析器</span><br><span class="line">		.build();</span><br><span class="line">		</span><br><span class="line">// 自动将我们的结果转为对应的对象</span><br><span class="line">@GET(&quot;blog/&#123;id&#125;&quot;)</span><br><span class="line">Call&lt;Result&lt;Book&gt;&gt; getBook(@Path(&quot;id&quot;) int id);</span><br></pre></td></tr></table></figure></responsebody></p>
</blockquote>

            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/tags/android/">android</a>
		  
			<a href="/tags/框架/">框架</a>
		  
			<a href="/tags/Retrofit/">Retrofit</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
    
      <a class="next" href="/2018/03/05/RxJava的学习记录/">
        <span class="next-text nav-default">RxJava的学习记录</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2014 -
    
    2018
    <span class="footer-author">John Doe.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a> and <a class="theme-link" href="https://github.com/frostfan/hexo-theme-polarbear">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
